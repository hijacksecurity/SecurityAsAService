# SCA Security Control
# Software Composition Analysis

sca:
  runs-on: ubuntu-latest
  container:
    image: ${{ vars.DOCKER_REGISTRY }}/${{ vars.DOCKER_REPOSITORY }}/semgrep:latest
    options: --user root
  
  steps:
    - name: Checkout code
      uses: actions/checkout@v4
      
    - name: Run SCA scan
      run: |
        semgrep ci \
          --supply-chain \
          --json \
          --output=semgrep-sca-results.json
      env:
        SEMGREP_APP_TOKEN: ${{ secrets.SEMGREP_APP_TOKEN }}
      
    - name: Upload scan results
      if: always()
      uses: actions/upload-artifact@v4
      with:
        name: sca-results
        path: semgrep-sca-results.json