# Semgrep SAST Security Control
# Reusable workflow for running Semgrep static analysis

semgrep-sast:
  runs-on: ubuntu-latest
  container:
    image: ${{ vars.DOCKER_REGISTRY }}/${{ vars.DOCKER_REPOSITORY }}/semgrep:latest
  
  steps:
    - name: Checkout code
      uses: actions/checkout@v4
      
    - name: Run Semgrep scan
      run: |
        semgrep scan \
          --config="${SEMGREP_CONFIG:-auto}" \
          --sarif \
          --output=semgrep-results.sarif \
          --metrics=off
      
    - name: Upload SARIF results
      if: always()
      uses: github/codeql-action/upload-sarif@v3
      with:
        sarif_file: semgrep-results.sarif
        category: semgrep